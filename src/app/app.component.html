<!-- Headings -->
<div *ngIf="gameIsStopped && showGameHistory && !showingTournament">
  <div class="game-history-index">
    Game<br /> #{{gameHistoryIndex+1}} of {{gameHistory.length}}
  </div>
</div>

<div *ngIf="gameIsStopped && !showGameHistory && !showingTournament && gameStats.rollHistory.length > 0"
  class="game-history-index">
  Game Stats
</div>
<div *ngIf="showingTournament && tourneyStats.rollHistory.length > 0" class="game-history-index">
  Tournament Stats
</div>

<div class="current-roll">
  {{ currentRoll }}
</div>

<!-- main area -->
<div class="container">
  <!-- Left column  -->
  <div class="dice-container">
  <button (click)="pauseGame()" class="pause-button">Pause Game</button>
  <button (click)="endGame()" class="pause-button end-button">End Game</button>

    <!-- Dice -->
    <div class="dice-group">
      <div class="sub-column">
        <div *ngFor="let die of dice | slice:0:3" (click)="selectDie(1, die)" class="dice die-one"
          [class.selected]="selectedDice[0] === die" [class.has-selected]="haveSelectedYellowDie()">
          {{ die }}
        </div>
      </div>
      <div class="sub-column">
        <div *ngFor="let die of dice | slice:3:6" (click)="selectDie(1, die)" class="dice die-one"
          [class.selected]="selectedDice[0] === die" [class.has-selected]="haveSelectedYellowDie()">
          {{ die }}
        </div>
      </div>
    </div>

    <div class="dice-group">
      <div class="sub-column">
        <div *ngFor="let die of dice | slice:0:3" (click)="selectDie(2, die)" class="dice die-two"
          [class.selected]="selectedDice[1] === die" [class.has-selected]="haveSelectedRedDie()">
          {{ die }}
        </div>
      </div>
      <div class="sub-column">
        <div *ngFor="let die of dice | slice:3:6" (click)="selectDie(2, die)" class="dice die-two"
          [class.selected]="selectedDice[1] === die" [class.has-selected]="haveSelectedRedDie()">
          {{ die }}
        </div>
      </div>
    </div>

    <!-- store button and some stats -->
    <div class="store-button-container">
      <button (click)="storeValues()" [disabled]="(selectedDice[0] == 0 || selectedDice[1] == 0)"
        class="gradient-btn store-button">
        Store
      </button>
      
      <button (click)="undoLastRoll()" class="pause-button undo-button">Undo</button>

      <p class="counter">
        {{showGamePause ? 'Break Duration' : 'Turn Duration:'}}
        <span class="counter-val">
          {{ showingTournament
            ? tourneyStats.breakDurationDisplay
            : ( gameIsStopped
                ? gameStats.breakDurationDisplay
                : ( showGamePause
                    ? breakDurationDisplay
                    : turnDurationDisplay
                  )
              )
          }}
        </span>
      </p>
      <p class="counter">Roll Count:
        <br />
        <span class="counter-val">{{rollCount()}}</span>
      </p>
      <!-- <p class="counter">Avg # Rolls between 7s:<br />
        <span class="counter-val">{{calculateAverageInterval(7)}}</span>
        <span class="counter-avg">(6.0)</span>
        <br />
        <span class="counter-val">{{getBarPercent(7)}}%</span>
        <span class="counter-avg">(16%)</span>
      </p> -->

      <p class="counter">
        {{showingTournament ? 'Tournament Duration:' : 'Game Duration'}}
        <!-- <br /> -->
        <span class="counter-val">
          {{ showingTournament ? tourneyStats.playingDurationDisplay : gameStats.playingDurationDisplay }}
        </span>
      </p>
    </div>

    
    <div class="color-picker-container">
      <div class="rocker-switch" (click)="toggleSounds()">
        <div class="switch" [class.active]="userSettings.playSounds"></div>
        <span class="label-left" [class.selected]="!userSettings.playSounds">Quiet</span>
        <span class="label-right" [class.selected]="userSettings.playSounds">Sounds</span>
      </div>
      
      <div class="rocker-switch" (click)="toggleDiePercent()">
        <div class="switch" [class.active]="showDieCounts"></div>
        <span class="label-left" [class.selected]="!showDieCounts">Percent</span>
        <span class="label-right" [class.selected]="showDieCounts">Count</span>
      </div>
      
      <div class="rocker-switch" (click)="toggleTournamentDisplay()">
        <div class="switch" [class.active]="!showingTournament"></div>
        <span class="label-left" [class.selected]="showingTournament">Tourney</span>
        <span class="label-right" [class.selected]="!showingTournament">Game</span>
      </div>

      <!-- <button (click)="showHelp()" class="help-button">Help</button> -->

      <div class="rocker-switch" (click)="toggleColorType()">
        <div class="switch" [class.active]="colorType"></div>
        <span class="label-left" [class.selected]="!colorType">Density</span>
        <span class="label-right" [class.selected]="colorType">Color</span>
      </div>

      <div *ngIf="userSettings.colorOption === ColorOption.Density">
        <br /><br />
        <label for="colorPicker">Select Color:</label>
        <input #densityColorInput id="colorPicker" type="color" [value]="colorService.colorDensityColor"
          (input)="updateRollFrequencyDensityColor(densityColorInput.value)" />
      </div>

      <div *ngIf="userSettings.colorOption === ColorOption.Color">
        <div class="rocker-switch" (click)="toggleColorPicker()">
          <div class="switch" [class.active]="colorPickerAll"></div>
          <span class="label-left" [class.selected]="!colorPickerAll">Ends</span>
          <span class="label-right" [class.selected]="colorPickerAll">All</span>
        </div>
        <br /><br />

        <div *ngIf="!colorPickerAll">
          <label>least frequent </label>
          <input #colorInputHigh type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[0])"
            (input)="colorService.colorGradients[0] = colorInputHigh.value" />
          <input #colorInputLow type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[10])"
            (input)="colorService.colorGradients[10] = colorInputLow.value" />
          <label>most frequent</label>
        </div>

        <div *ngIf="colorPickerAll">
          <!-- I had this in a loop, but the color selector would disappear when the user clicks to adjust color.  splitting out like this resolves the issue -->
          <label>least frequent</label>
          <input #colorInput0 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[0])"
            (input)="updateRollFrequencyColor(0, colorInput0.value)" />
          <input #colorInput1 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[1])"
            (input)="updateRollFrequencyColor(1, colorInput1.value)" />
          <input #colorInput2 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[2])"
            (input)="updateRollFrequencyColor(2, colorInput2.value)" />
          <input #colorInput3 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[3])"
            (input)="updateRollFrequencyColor(3, colorInput3.value)" />
          <input #colorInput4 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[4])"
            (input)="updateRollFrequencyColor(4, colorInput4.value)" />
          <input #colorInput5 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[5])"
            (input)="updateRollFrequencyColor(5, colorInput5.value)" />
          <input #colorInput6 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[6])"
            (input)="updateRollFrequencyColor(6, colorInput6.value)" />
          <input #colorInput7 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[7])"
            (input)="updateRollFrequencyColor(7, colorInput7.value)" />
          <input #colorInput8 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[8])"
            (input)="updateRollFrequencyColor(8, colorInput8.value)" />
          <input #colorInput9 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[9])"
            (input)="updateRollFrequencyColor(9, colorInput9.value)" />
          <input #colorInput10 type="color" [value]="colorService.rgbaToHex(colorService.colorGradients[10])"
            (input)="updateRollFrequencyColor(10, colorInput10.value)" />
          <br />
          <label>most frequent</label>
        </div>

        <button *ngIf="!colorPickerAll && userSettings.colorOption != ColorOption.Density"
          (click)="mapNewColors(colorService.colorGradients[0], colorService.colorGradients[10])">
          Map Colors
        </button>
      </div>
    </div>
  </div>

  <div class="toggle-bar" (click)="toggleDiceContainer()">☰</div>

  <!-- central display : bar chart display showing how many times each number has been rolled -->
  <div class="bar-container">
    <div *ngFor="let number of numberRange"> <!--  2 - 12 -->
      <div class="bar-box">
        <!-- the # of the die -->
        <!-- color mapping gives a highlight to show how often this number rolls (red = the most, green = the least) -->
        <div class="bar-number"
          [style.boxShadow]="'0 2px 15px 3px ' + colorService.colorMappedRolls[number]">
          {{ number > 0 ? number : '' }}
        </div>

        <!-- Trend indicator -->
        <div class="trend-indicator" [title]="trendService.getTrendTooltip(tourneyStats, number)"
          [class.rising]="trendService.isNumberRising(tourneyStats, number)"
          [class.falling]="!trendService.isNumberRising(tourneyStats, number)">
          {{ trendService.isNumberRising(tourneyStats, number) ? '▲' : '▼' }}
        </div>

        <!--  # times this # has rolled -->
        <div class="bar-count" *ngIf="showDieCounts"
          style="color: red;">
          {{ bars[number] <= 0 ? '0' : bars[number] }} </div>
            <div class="bar-count bar-percent" *ngIf="!showDieCounts" style="color: red;">
              {{ bars[number] <= 0 ? '0' : getBarPercent(number) }} <div class="percent-sign">%</div>
        </div>

        <!-- Overlay to display the roll histoy
          (series of squares representing the rolls, a filled square is when this number rolled, else, some other number rolled) -->
        <div #overlay class="bar-overlay" *ngIf="!showingTournament" [style.color]="'white'"
          [style.font-size.rem]="rollHistoryFontSize">
          <span [innerHTML]="getRollHistory(number)"></span>
        </div>

        <!-- roll counts in bar chat form -->
        <div #bar class="bar" [style.width.%]="barParentWidth > 0 && bars[number] > 0 
          ? ((bars[number] / maxRollCount()) * 100) - (43 / barParentWidth * 100) 
          : 0" [style.background-color]="number == 7 ? 'Red' : 'Blue'">
        </div>

        <!-- The red bar for tournament roll frequency -->
        <div class="tournament-bar" *ngIf="!showingTournament"
          [style.background-color]="number == 7 ? 'Blue' : 'Red'" [style.width.%]="barParentWidth > 0 && tourneyStats.rolls[number] > 0 
          ? ((tourneyStats.rolls[number] / maxRollCountTourney()) * 100) - (43 / barParentWidth * 100) 
          : 0">
        </div>

      </div>
    </div>
  </div>
</div>


<!-- div to block page content while the we are prompting the user (play/resume) --><!-- showPopupMessage|| -->
<div [ngClass]="(showGamePause || showHelpDialog) ? 'block-app' : 'normal'" [style.opacity]="blockScreenOpacity"></div>

<button *ngIf="showGamePause && !showHelpDialog && !showColorPickerColors" (click)="startResumeGame()"
  [style.opacity]="resumeButtonOpacity" class="user-message-popup gradient-btn-start store-button" style="color: White;">
  {{ gameIsStopped ? 'Start New Game' : 'Resume Game' }}
</button>

<div *ngIf="showHelpDialog" class="user-message-popup help-dialog">
  <h2>Welcome to Boba-Zeke's Dice Stats</h2>
  <div class="help-popup-content">
    <p>Click on the dice to select them, or use the keyboard to enter the roll. After entering two numbers, the sum will
      be displayed for confirmation. If that isn't the number you want, just reselect the numbers. When ready, hit Enter
      or click the "Store" button to save the roll.</p>
    <p>Use the context menu (right-click) to start and stop games and for additional options.</p>
    <p>F1 : show this Help screen</p>
    <p>CTRL : toggle game stats & tournament stats</p>
    <p>SHIFT : toggle count stats & percentage stats</p>
    <p>Arrow keys during a game: change history overlay size</p>
    <p>Arrow keys after a game: scroll through game history</p>
    <p>While paused, use mouse scroll to change screen opacity</p>
    <button (click)="showHelpDialog = false">Close</button>
  </div>
</div>